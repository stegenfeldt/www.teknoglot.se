<!DOCTYPE html>
<html>
<head>
    <!-- hexo-inject:begin --><script src='https://unpkg.com/echarts@3.3.2/dist/echarts.min.js'></script><!-- hexo-inject:end --><meta charset="utf-8">
    
    <title>OpsMgr 2012 Agent Failover ‚Äì A Faster Script with Wildcards [#opsmgr, #powershell] | teknoglot:</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="OpsMgr,PoSH,Script,Fail-over" />
    
    <meta name="description" content="Now we‚Äôre gonna make things even faster! In the previous post on the subject of Agent¬†Fail-over¬†in Operations Manager 2012 we created a script that will go through a selection of agents and make sure">
<meta name="keywords" content="OpsMgr,PoSH,Script,Fail-over">
<meta property="og:type" content="article">
<meta property="og:title" content="OpsMgr 2012 Agent Failover ‚Äì A Faster Script with Wildcards [#opsmgr, #powershell]">
<meta property="og:url" content="https:&#x2F;&#x2F;www.teknoglot.se&#x2F;ms&#x2F;opsmgr2012&#x2F;opsmgr-2012-agent-failover-a-faster-script-with-wildcards-opsmgr-powershell&#x2F;index.html">
<meta property="og:site_name" content="teknoglot:">
<meta property="og:description" content="Now we‚Äôre gonna make things even faster! In the previous post on the subject of Agent¬†Fail-over¬†in Operations Manager 2012 we created a script that will go through a selection of agents and make sure">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-11-19T09:13:29.081Z">
<meta name="twitter:card" content="summary">
    

    

    
        <link rel="icon" href="/favicon.png" />
    

    <link rel="stylesheet" href="/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/vendor/titillium-web/styles.css">
    <link rel="stylesheet" href="/vendor/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/vendor/jquery/2.0.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/vendor/fancybox/jquery.fancybox.css">
    
    
    
        <script type="text/javascript">
(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-382656-8', 'auto');
ga('send', 'pageview');

</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
    
    

</head>

<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                        <li class="main-nav-list-item">
                                            <a class="main-nav-list-link" href="/">
                                                Home
                                            </a>
                                        </li>
                                        
                                <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/code/">Code</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/code/posh/">PoSH</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/code/vbs/">VBS</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/Events/">Events</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/Events/MSIgnite-2017/">MSIgnite 2017</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/Fieldnotes/">Fieldnotes</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/Fieldnotes/OpsMgr/">OpsMgr</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/linux/">Linux</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/linux/rhes/">RedHat ES</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/linux/sles/">SLES</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/linux/ubuntu/">Ubuntu</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/ms/">Microsoft</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/ms/opsmgr1801/">OpsMgr 1801</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/ms/opsmgr1807/">OpsMgr 1807</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/ms/opsmgr2007/">OpsMgr 2007</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/ms/opsmgr2012/">OpsMgr 2012</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/ms/opsmgr2016/">OpsMgr 2016</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/ms/sql/">SQL Server</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/ms/windows/">Windows</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/ms/winvista/">Windows Vista</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/mikrotik/">Mikrotik</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/tb/">Technobabble</a></li></ul>
                                    
                                        <li class="main-nav-list-item">
                                            <a class="main-nav-list-link" href="/About/">
                                                About
                                            </a>
                                        </li>
                                        
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/topics/ms/">Microsoft</a><i class="icon fa fa-angle-right"></i><a class="page-title-link" href="/topics/ms/opsmgr2012/">OpsMgr 2012</a>
    </h1>
</div>
                        <div class="main-body-content">
                            <article id="post-opsmgr-2012-agent-failover-a-faster-script-with-wildcards-opsmgr-powershell" class="article article-single article-type-post" itemscope
    itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        OpsMgr 2012 Agent Failover ‚Äì A Faster Script with Wildcards [#opsmgr, #powershell]
        </h1>
    

            </header>
            
                <div class="article-subtitle">
                    <a href="/ms/opsmgr2012/opsmgr-2012-agent-failover-a-faster-script-with-wildcards-opsmgr-powershell/" class="article-date">
    <time datetime="2012-06-28T12:28:36.000Z" itemprop="datePublished">2012-06-28</time>
</a>
                        
    <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/Fail-over/" rel="tag">Fail-over</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/OpsMgr/" rel="tag">OpsMgr</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/PoSH/" rel="tag">PoSH</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/Script/" rel="tag">Script</a></li></ul>

                </div>
                <div class="article-entry" itemprop="articleBody">
                    <p>Now we‚Äôre gonna make things even faster! In the <a href="http://www.teknoglot.se/code/powershell/opsmgr-2012-agent-failover-simple-script-with-wildcards-opsmgr-powershell/" title="OpsMgr 2012 Agent Failover ‚Äì Simple Script with Wildcards [#opsmgr, #powershell]">previous post</a> on the subject of <a href="http://www.teknoglot.se/series/om2012-failover-mgmt/">Agent¬†Fail-over¬†in Operations Manager 2012</a> we created a script that will go through a selection of agents and make sure that they all have up-to-date¬†fail-over¬†settings. We are doing the same thing in this one, but making it go faster. In my lab, it‚Äôs about five times faster in fact and I only have about 20 agents to play with. Not really a big deal, but scale it up a bit and add a few thousand agents and the pay-off will be very significant.</p>
<p>As usual, the script will work as is, but it really is more to show the concept. You would have to add filtering to make sure you don‚Äôt mix agents behind gateway servers and agents behind management servers. Giving an agent behind a gateway a management servers as it‚Äôs fail-over server will likely not help you in any way.</p>
<p>We will pretty quickly go ‚Äúadvanced‚Äù this time, so buckle up. üòâ</p>
<a id="more"></a>
<p>Being a slight modification of the script in the last post I am not going to go through those details. Use that post if you need references to the Inputs, the OpsMgr 2012 Modules, Management Group connection and gathering your agents and management servers.</p>
<h3 id="why-is-it-faster"><a class="markdownIt-Anchor" href="#why-is-it-faster"></a> Why Is It Faster?</h3>
<p>We are doing the same thing, on the same agents and with the same servers. And we already did some optimization by loading them all into memory and working from there. How do you make it faster? Basically, I‚Äôm cutting the over-head of the cmdlets and how they work. You may have noticed that in the ‚ÄúDo Stuff‚Äù section, we are actually calling the <code>Set-SCOMParentManagementServer</code> cmdlet twice! Once for the primary Management Server and once for the fail-over Management Servers. In effect, we connect, fire a command, wait for result, and disconnect two times for each agent. And pretty much only because the cmdlet does not offer support to set primary and fail-over management servers at the same time. Any attempt to do so will return an ambiguous¬†parameter error.</p>
<p>I don‚Äôt like that. A brief look at the agent object class,¬†<a href="http://msdn.microsoft.com/en-us/library/microsoft.enterprisemanagement.administration.agentmanagedcomputer.aspx" target="_blank" rel="noopener">Microsoft.EnterpriseManagement.Administration.AgentManagedComputer</a>, revealed a method called¬†<a href="http://msdn.microsoft.com/en-us/library/microsoft.enterprisemanagement.administration.agentmanagedcomputer.setmanagementservers" target="_blank" rel="noopener" title="AgentManagedComputer.SetManagementServers Method">SetManagementServers</a>. This method takes, or actually ‚Äúrequires‚Äù, two parameters. One for primary and one for fail-over management servers. Yay!</p>
<p>Using this method saves us a bunch of over-head and a couple of round-trips to the SDK-service.</p>
<h3 id="the-challenge"><a class="markdownIt-Anchor" href="#the-challenge"></a> The Challenge</h3>
<p>Unfortunately, you cannot simply toss an array of management servers at the SetManagementServers method. With a bit of knowledge or keen eyes you will spot the problem right away. I didn‚Äôt and was pulling my hair for a while until I realized what caused the errors. Looking closer at how¬†the method is defined we see this:</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetManagementServers</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params"> ManagementServer managementServer,</span></span></span><br><span class="line"><span class="function"><span class="params"> IList failoverManagementServers</span></span></span><br><span class="line"><span class="function"><span class="params"> </span>)</span></span><br></pre></td></tr></table></figure>
<p>You see that <code>IList&lt;ManagementServer&gt;</code> part?<br />
That‚Äôs the problem. When you run <code>Get-SCOMManagementServer</code> and save the result to a powershell variable, you will get a powershell ‚ÄúEnumerable‚Äù. In C#, that would be a class that implements the <code>IEnumerable</code> interface. Sad part is, it does not also implement <code>IList</code>. If you are thinking ‚ÄúIList‚Ä¶ IEnumerable‚Ä¶ Interface‚Ä¶ Whaaaaa‚Ä¶???‚Äù right now, don‚Äôt worry. You don‚Äôt have to understand this to read the script later on, just think of it as different types of data.</p>
<p>To get around this, we create a new object based on the dotNET List type and populate it with the management servers in our $scomFailOverMS array.</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$scomMSList</span> = <span class="built_in">New-Object</span> <span class="string">'Collections.Generic.List[Microsoft.EnterpriseManagement.Administration.ManagementServer]'</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$scomMS</span> <span class="keyword">in</span> <span class="variable">$scomFailOverMS</span>) &#123;</span><br><span class="line"> <span class="comment"># Loop through the array and add your failover MSs to the list</span></span><br><span class="line"> <span class="variable">$scomMSList</span>.Add(<span class="variable">$scomMS</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:We have to do that foreach loop since our $scomMSList object do not implement IEnumerable<br />
Still with me?</p>
</blockquote>
<h3 id="configuring-the-agent"><a class="markdownIt-Anchor" href="#configuring-the-agent"></a> Configuring the Agent</h3>
<p>As the method exist on that <code>AgentManagedComputer</code> class we will call it on our <code>$scomAgent</code> object, like this:</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$scomAgent</span>.SetManagementServers(<span class="variable">$scomPrimaryMS</span>,<span class="variable">$scomMSList</span>)</span><br></pre></td></tr></table></figure>
<p>And we‚Äôre done!</p>
<p>I had some doubt that this would be an improvement at first since we have to create our own objects and run an extra foreach-loop, but as we only work on objects in memory and only speak to the SDK service once per agent, we cut a lot of over-head and delays from our execution. On 20-ish agents in a lab, I‚Äôve measured the execution time drop to barely a fifth.</p>
<h3 id="the-copypaste-part"><a class="markdownIt-Anchor" href="#the-copypaste-part"></a> The Copy/Paste Part</h3>
<p>And here‚Äôs the entire script with a few added comments for clarity. Read, adapt and try it. In a lab, preferably.</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Input SCOM Management Server to connect to in this session</span></span><br><span class="line">[string]<span class="variable">$inputScomMS</span> = <span class="string">"scomms02.domain.local"</span></span><br><span class="line"><span class="comment"># Input an existing agent you want to modify</span></span><br><span class="line">[string]<span class="variable">$inputTargetAgent</span> = <span class="string">"*.domain.local"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Connect to SCOM 2012 Management Group ###</span></span><br><span class="line"><span class="keyword">If</span> (<span class="built_in">Get-Module</span> -Name <span class="string">"OperationsManager"</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">Import-Module</span> -Name <span class="string">"OperationsManager"</span></span><br><span class="line">    &#125; catch &#123;</span><br><span class="line">        echo <span class="string">"Could not load Operations Manager module"</span></span><br><span class="line">        <span class="keyword">exit</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">New-SCOMManagementGroupConnection -ComputerName <span class="variable">$inputScomMS</span></span><br><span class="line"><span class="comment">### END ###</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$scomAgents</span> = Get-SCOMAgent -DNSHostName <span class="variable">$inputTargetAgent</span> | Where &#123;<span class="variable">$_</span>.ManuallyInstalled <span class="nomarkup">-ne</span> <span class="literal">$true</span>&#125;</span><br><span class="line"><span class="comment"># Get all of the management servers</span></span><br><span class="line"><span class="comment"># It is ofcourse possible to search by hostname and wildcards using selected</span></span><br><span class="line"><span class="comment"># parameters to the cmdlet.</span></span><br><span class="line"><span class="variable">$scomManagementServers</span> = Get-SCOMManagementServer</span><br><span class="line"><span class="comment"># Switch to the following line to only get Gateway Servers</span></span><br><span class="line"><span class="comment">#$scomManagementServers = Get-SCOMGatewayManagementServer</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$scomAgent</span> <span class="keyword">in</span> <span class="variable">$scomAgents</span>) &#123;</span><br><span class="line">    <span class="comment"># Get the primary management server for the agent</span></span><br><span class="line">    <span class="variable">$scomPrimaryMS</span> = <span class="variable">$scomManagementServers</span> | where &#123;<span class="variable">$_</span>.Name <span class="nomarkup">-eq</span> <span class="variable">$scomAgent</span>.PrimaryManagementServerName&#125;</span><br><span class="line">    <span class="comment"># Remove the primary MS from "all MS" array to use it for FailOver servers</span></span><br><span class="line">    <span class="variable">$scomFailOverMS</span> = <span class="variable">$scomManagementServers</span> | where &#123;<span class="variable">$_</span>.Name <span class="nomarkup">-ne</span> <span class="variable">$scomPrimaryMS</span>.Name&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Create a new IList derived object for the failover MSs</span></span><br><span class="line">    <span class="comment"># You have to do this because the SetManagementServers() method requires an</span></span><br><span class="line">    <span class="comment"># IList and the MS-array is an IEnumerable type. So we basically create</span></span><br><span class="line">    <span class="comment"># a new IList object och the ManagementServer type.</span></span><br><span class="line">    <span class="variable">$scomMSList</span> = <span class="built_in">New-Object</span> <span class="string">'Collections.Generic.List[Microsoft.EnterpriseManagement.Administration.ManagementServer]'</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$scomMS</span> <span class="keyword">in</span> <span class="variable">$scomFailOverMS</span>) &#123;</span><br><span class="line">        <span class="comment"># Loop through the array and add your failover MSs to the list</span></span><br><span class="line">        <span class="variable">$scomMSList</span>.Add(<span class="variable">$scomMS</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$scomAgent</span>.SetManagementServers(<span class="variable">$scomPrimaryMS</span>, <span class="variable">$scomMSList</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>GLHF!</p>

                </div>
                <footer class="article-footer">
                    



    <a data-url="https://www.teknoglot.se/ms/opsmgr2012/opsmgr-2012-agent-failover-a-faster-script-with-wildcards-opsmgr-powershell/" data-id="ck35pwgnt0013t0gkbyur61cu" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

                </footer>
                <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                <!-- Teknoglot - After Article -->
                <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8265950273936175" data-ad-slot="2559523773" data-ad-format="auto"
                    data-full-width-responsive="true"></ins>
                <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
    </div>
</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>

                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>follow:</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="twitter" href="https://twitter.com/teknoglot" target="_blank">
                        <i class="icon fa fa-twitter"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="google-plus" href="https://plus.google.com/+teknoglotse" target="_blank">
                        <i class="icon fa fa-google-plus"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="bitbucket" href="https://bitbucket.org/stegenfeldt" target="_blank">
                        <i class="icon fa fa-bitbucket"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/stegenfeldt" target="_blank">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="rss" href="/rss.xml" target="_blank">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/ms/opsmgr2007/quick-demo-add-windows-performance-collection-rule-opsmgr-mpauthoring/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">newer</strong>
        <p class="article-nav-title">
        
            Quick Demo - Add Windows Performance Collection Rule [#opsmgr, #mpauthoring]
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/ms/opsmgr2012/opsmgr-2012-agent-failover-simple-script-with-wildcards-opsmgr-powershell/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">older</strong>
        <p class="article-nav-title">OpsMgr 2012 Agent Failover - Simple Script with Wildcards [#opsmgr, #powershell]</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                
    <div class="widget-wrap">
        <h3 class="widget-title">recents</h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/topics/Fieldnotes/">Fieldnotes</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/topics/Fieldnotes/OpsMgr/">OpsMgr</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/topics/ms/">Microsoft</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/topics/ms/opsmgr1801/">OpsMgr 1801</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/topics/ms/opsmgr1807/">OpsMgr 1807</a></p>
                            <p class="item-title"><a href="/ms/opsmgr1801/Upgrading-OpsMgr-1801-to-1807-Fieldnotes/" class="title">Upgrading #OpsMgr 1801 to 1807 - Fieldnotes</a></p>
                            <p class="item-date"><time datetime="2018-09-06T12:42:51.000Z" itemprop="datePublished">2018-09-06</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/topics/ms/">Microsoft</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/topics/ms/opsmgr2016/">OpsMgr 2016</a></p>
                            <p class="item-title"><a href="/ms/opsmgr2016/om1801-upgrade-gotchas/" class="title">#OpsMgr 1801 Upgrade - The Fail Anthology</a></p>
                            <p class="item-date"><time datetime="2018-08-27T13:42:17.000Z" itemprop="datePublished">2018-08-27</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/topics/Events/">Events</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/topics/Events/MSIgnite-2017/">MSIgnite 2017</a></p>
                            <p class="item-title"><a href="/Events/MSIgnite-2017/MSIgnite-2017-BRK1039-Windows-Server-Software-Defined/" class="title">#MSIgnite 2017: BRK1039 - Windows Server Software Defined</a></p>
                            <p class="item-date"><time datetime="2017-09-26T08:23:13.000Z" itemprop="datePublished">2017-09-26</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/topics/Events/">Events</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/topics/Events/MSIgnite-2017/">MSIgnite 2017</a></p>
                            <p class="item-title"><a href="/Events/MSIgnite-2017/MSIgnite-2017-GS01-Microsoft-for-the-Modern-Data-Estate/" class="title">#MSIgnite 2017: GS01 - Microsoft for the Modern Data Estate</a></p>
                            <p class="item-date"><time datetime="2017-09-25T13:34:36.000Z" itemprop="datePublished">2017-09-25</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/topics/Events/">Events</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/topics/Events/MSIgnite-2017/">MSIgnite 2017</a></p>
                            <p class="item-title"><a href="/Events/MSIgnite-2017/MSIgnite-2017-TK01-Create-a-Modern-Workplace-with-Microsoft-365/" class="title">#MSIgnite 2017: TK01 - Create a Modern Workplace with Microsoft 365</a></p>
                            <p class="item-date"><time datetime="2017-09-25T10:17:15.000Z" itemprop="datePublished">2017-09-25</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">categories</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/topics/code/">Code</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/topics/code/posh/">PoSH</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/code/vbs/">VBS</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/topics/Events/">Events</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/topics/Events/MSIgnite-2017/">MSIgnite 2017</a><span class="category-list-count">4</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/topics/Fieldnotes/">Fieldnotes</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/topics/Fieldnotes/OpsMgr/">OpsMgr</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/topics/linux/">Linux</a><span class="category-list-count">5</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/topics/linux/rhes/">RedHat ES</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/linux/sles/">SLES</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/linux/ubuntu/">Ubuntu</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/topics/ms/">Microsoft</a><span class="category-list-count">41</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/topics/ms/opsmgr1801/">OpsMgr 1801</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/ms/opsmgr1807/">OpsMgr 1807</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/ms/opsmgr2007/">OpsMgr 2007</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/ms/opsmgr2012/">OpsMgr 2012</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/ms/opsmgr2016/">OpsMgr 2016</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/ms/sql/">SQL Server</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/ms/windows/">Windows</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/topics/ms/windows/winxp/">Windows XP</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/topics/ms/winvista/">Windows Vista</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/topics/mikrotik/">Mikrotik</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/tb/">Technobabble</a><span class="category-list-count">9</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-float">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tag/ACS/" style="font-size: 10px;">ACS</a> <a href="/tag/Advanced-Threat-Protection/" style="font-size: 10px;">Advanced Threat Protection</a> <a href="/tag/Checklist/" style="font-size: 10px;">Checklist</a> <a href="/tag/Conference/" style="font-size: 10px;">Conference</a> <a href="/tag/DNS/" style="font-size: 10px;">DNS</a> <a href="/tag/Drivers/" style="font-size: 12.5px;">Drivers</a> <a href="/tag/Errors/" style="font-size: 15px;">Errors</a> <a href="/tag/Exchange/" style="font-size: 10px;">Exchange</a> <a href="/tag/Fail-over/" style="font-size: 12.5px;">Fail-over</a> <a href="/tag/Field-Notes/" style="font-size: 12.5px;">Field Notes</a> <a href="/tag/Fieldnotes/" style="font-size: 10px;">Fieldnotes</a> <a href="/tag/Fixed/" style="font-size: 10px;">Fixed</a> <a href="/tag/GSM/" style="font-size: 10px;">GSM</a> <a href="/tag/Gist/" style="font-size: 10px;">Gist</a> <a href="/tag/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tag/Highly-Available/" style="font-size: 10px;">Highly-Available</a> <a href="/tag/How-To/" style="font-size: 17.5px;">How-To</a> <a href="/tag/HowTo/" style="font-size: 10px;">HowTo</a> <a href="/tag/Hyper-Converged/" style="font-size: 10px;">Hyper-Converged</a> <a href="/tag/Hyper-V/" style="font-size: 10px;">Hyper-V</a> <a href="/tag/IIS7/" style="font-size: 10px;">IIS7</a> <a href="/tag/Invoke-RestMethod/" style="font-size: 10px;">Invoke-RestMethod</a> <a href="/tag/Issues/" style="font-size: 10px;">Issues</a> <a href="/tag/KB/" style="font-size: 11.25px;">KB</a> <a href="/tag/Linux/" style="font-size: 13.75px;">Linux</a> <a href="/tag/MP-Development/" style="font-size: 12.5px;">MP Development</a> <a href="/tag/MSIgnite/" style="font-size: 13.75px;">MSIgnite</a> <a href="/tag/MSMQ/" style="font-size: 13.75px;">MSMQ</a> <a href="/tag/Machine-Learning/" style="font-size: 10px;">Machine Learning</a> <a href="/tag/Macro/" style="font-size: 10px;">Macro</a> <a href="/tag/Management-Pack/" style="font-size: 18.75px;">Management Pack</a> <a href="/tag/Microsoft-265/" style="font-size: 10px;">Microsoft 265</a> <a href="/tag/Microsoft-Teams/" style="font-size: 10px;">Microsoft Teams</a> <a href="/tag/Mikrotik/" style="font-size: 10px;">Mikrotik</a> <a href="/tag/NLB/" style="font-size: 10px;">NLB</a> <a href="/tag/NVidia/" style="font-size: 10px;">NVidia</a> <a href="/tag/Office/" style="font-size: 10px;">Office</a> <a href="/tag/Office-365/" style="font-size: 10px;">Office 365</a> <a href="/tag/OneDrive/" style="font-size: 10px;">OneDrive</a> <a href="/tag/OpenVPN/" style="font-size: 10px;">OpenVPN</a> <a href="/tag/OpsMgr/" style="font-size: 20px;">OpsMgr</a> <a href="/tag/OpsMgr-1801/" style="font-size: 10px;">OpsMgr 1801</a> <a href="/tag/OpsMgr-2007/" style="font-size: 10px;">OpsMgr 2007</a> <a href="/tag/OpsMgr-2012-R2/" style="font-size: 11.25px;">OpsMgr 2012 R2</a> <a href="/tag/OpsMgr-2016/" style="font-size: 10px;">OpsMgr 2016</a> <a href="/tag/PoSH/" style="font-size: 16.25px;">PoSH</a> <a href="/tag/Powershell/" style="font-size: 11.25px;">Powershell</a> <a href="/tag/Presentation-Notes/" style="font-size: 13.75px;">Presentation Notes</a> <a href="/tag/Quick-Reference/" style="font-size: 10px;">Quick Reference</a> <a href="/tag/Quick-fix/" style="font-size: 10px;">Quick-fix</a> <a href="/tag/Quick-hack/" style="font-size: 10px;">Quick-hack</a> <a href="/tag/RHES5/" style="font-size: 10px;">RHES5</a> <a href="/tag/Rant/" style="font-size: 13.75px;">Rant</a> <a href="/tag/RedHat/" style="font-size: 10px;">RedHat</a> <a href="/tag/Reporting-Services/" style="font-size: 10px;">Reporting Services</a> <a href="/tag/RouterOS/" style="font-size: 10px;">RouterOS</a> <a href="/tag/SMS/" style="font-size: 10px;">SMS</a> <a href="/tag/SQL-2017/" style="font-size: 10px;">SQL 2017</a> <a href="/tag/SQL-Express-2005/" style="font-size: 10px;">SQL Express 2005</a> <a href="/tag/SQL-Express-2008/" style="font-size: 10px;">SQL Express 2008</a> <a href="/tag/SQL-Server/" style="font-size: 11.25px;">SQL Server</a> <a href="/tag/SQL-Server-2005/" style="font-size: 10px;">SQL Server 2005</a> <a href="/tag/SQL-Server-2008/" style="font-size: 10px;">SQL Server 2008</a> <a href="/tag/SQL-on-Linux/" style="font-size: 10px;">SQL on Linux</a> <a href="/tag/SUSE-11/" style="font-size: 10px;">SUSE 11</a> <a href="/tag/Script/" style="font-size: 16.25px;">Script</a> <a href="/tag/Scripts/" style="font-size: 10px;">Scripts</a> <a href="/tag/SharePoint/" style="font-size: 10px;">SharePoint</a> <a href="/tag/Sillyness/" style="font-size: 10px;">Sillyness</a> <a href="/tag/SquaredUp/" style="font-size: 10px;">SquaredUp</a> <a href="/tag/Teach-a-Man-to-Fish/" style="font-size: 10px;">Teach a Man to Fish</a> <a href="/tag/TechNet/" style="font-size: 10px;">TechNet</a> <a href="/tag/Technical-Keynote/" style="font-size: 10px;">Technical Keynote</a> <a href="/tag/Teknoglot/" style="font-size: 12.5px;">Teknoglot</a> <a href="/tag/TroubleShooting/" style="font-size: 11.25px;">TroubleShooting</a> <a href="/tag/Tutorial/" style="font-size: 10px;">Tutorial</a> <a href="/tag/Unix/" style="font-size: 10px;">Unix</a> <a href="/tag/Update-Rollup/" style="font-size: 11.25px;">Update Rollup</a> <a href="/tag/Upgrade/" style="font-size: 10px;">Upgrade</a> <a href="/tag/VBScript/" style="font-size: 10px;">VBScript</a> <a href="/tag/Video/" style="font-size: 10px;">Video</a> <a href="/tag/Virtual-Appliance/" style="font-size: 10px;">Virtual Appliance</a> <a href="/tag/WMI/" style="font-size: 10px;">WMI</a> <a href="/tag/WSSD/" style="font-size: 10px;">WSSD</a> <a href="/tag/Windows/" style="font-size: 12.5px;">Windows</a> <a href="/tag/Windows-2008/" style="font-size: 10px;">Windows 2008</a> <a href="/tag/Windows-Installer/" style="font-size: 10px;">Windows Installer</a> <a href="/tag/Windows-Vista/" style="font-size: 10px;">Windows Vista</a> <a href="/tag/Windows-XP/" style="font-size: 10px;">Windows XP</a> <a href="/tag/Word/" style="font-size: 10px;">Word</a> <a href="/tag/Wordpress/" style="font-size: 10px;">Wordpress</a> <a href="/tag/X-Plat/" style="font-size: 11.25px;">X-Plat</a> <a href="/tag/Yammer/" style="font-size: 10px;">Yammer</a> <a href="/tag/x64/" style="font-size: 11.25px;">x64</a>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://www.atea.se/" target="_blank" rel="noopener">Atea</a>
                    </li>
                
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>
                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;" target="_blank" rel="noopener"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2019 Samuel Tegenfeldt</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
            </div>
        </div>
    </div>
</footer>
        
    
    <script>
    var disqus_shortname = 'teknoglotse';
    
    
    var disqus_url = 'https://www.teknoglot.se/ms/opsmgr2012/opsmgr-2012-agent-failover-a-faster-script-with-wildcards-opsmgr-powershell/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>



    
        <script src="/vendor/fancybox/jquery.fancybox.pack.js"></script>
    

    


<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>
